<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueRiot Syndicate - TL Dashboard</title>

    <!-- CSS Modules -->
    <link rel="stylesheet" href="./src/styles/base.css">
    <link rel="stylesheet" href="./src/styles/layout.css">
    <link rel="stylesheet" href="./src/styles/components.css">

    <!-- Supabase Client - MUST use specific version for compatibility -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4"></script>

    <!-- Initialize Supabase BEFORE modules load -->
    <script>
        // Setup Supabase globally so components can use it immediately
        const SUPABASE_URL = 'https://kvomxtzcnczvbcscybcy.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_WgMzf0xMBQ6a8WMcun3fvg_sUfBQ8qC';

        window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('âœ… Supabase client initialized globally');
        console.log('ðŸš€ BlueRiot Dashboard v2024-12-09-v4');
    </script>

    <!-- App Initialization -->
    <script type="module">
        import { router } from './src/utils/router.js';
        import { auth } from './src/utils/auth.js';
        import './src/components/login-panel.js';
        import './src/components/dashboard-frame.js';

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ðŸš€ BlueRiot Dashboard - Modular Architecture');
            console.log('ðŸ“¦ Web Components loaded');

            // Initialize auth manager (uses already-created supabaseClient)
            auth.init();

            // Register routes
            router.register('login', async () => {
                console.log('ðŸ“„ Showing login screen');
            });

            router.register('dashboard', async () => {
                console.log('ðŸ“„ Showing dashboard screen');
            });

            // Check if user is already authenticated
            const isAuthenticated = await auth.checkAuth();

            if (!isAuthenticated) {
                // Show login screen
                await router.navigate('login');
            }

            console.log('âœ… App initialized');
        });
    </script>
</head>
<body>
    <!-- Login Screen -->
    <div data-screen="login" class="active">
        <login-panel></login-panel>
    </div>

    <!-- Dashboard Screen -->
    <div data-screen="dashboard">
        <dashboard-frame></dashboard-frame>
    </div>
</body>
</html>
